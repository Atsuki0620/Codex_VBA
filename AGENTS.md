# プロジェクト共通ルール

## 目的
- このリポジトリは、任意の `.xlsm` ファイルから VBA モジュールを高速エクスポートし、Azure OpenAI を用いた要約・関係性推定・最終レポート生成までを自動化する Jupyter Notebook を提供する。
- すべての記述（マークダウン、コードコメント、ドキュメント、応答メッセージ）は日本語で統一する。

## 対象と入力制約
- `TKA01_companycal_and_easysche.ver.1.0.0.xlsm` をサンプルとして利用してよいが、特定ファイルに依存するロジックを組み込んではならない。
- `.xlsm` 内のすべての VBA コンポーネント（標準モジュール、クラスモジュール、フォーム）を `.bas/.cls/.frm(+.frx)` に出力できること。

## ノートブック構成ルール
- 各コードセルの直前には、そのセルの狙い・入出力・前提を説明するマークダウンセルを必ず配置する。
- コードセル内には主要処理の流れが初見でも理解できるようにコメントを挿入する。
- セルは以下の必須機能に対応する責務を明確にすること。
  1. 高速エクスポート：Excel COM を利用した VBA モジュールの一括抽出。
  2. 生成 AI の準備：`.env` からプロキシ・キー・エンドポイント・バージョンを読み込み、Azure OpenAI に接続する設定。
  3. 要約（ファイル単位）：エクスポート済みファイルを読み込み、日本語での要約生成。
  4. 関係性の推定：モジュールと主要プロシージャから Mermaid 形式のシーケンス図を生成。
  5. 最終レポート生成：要約とシーケンス図を統合した Markdown ファイルの作成。

## 環境・依存関係
- Windows 上の Excel デスクトップおよび `pywin32`, `python-dotenv`, `openai` などの Python ライブラリを利用する前提で記述する。
- `.env` ファイルからの接続情報読み込みとプロキシ設定方法を明示する。

## エラーハンドリング方針
- Excel COM 操作では例外発生時にも `Workbook.Close` と `Application.Quit` を保証する。
- ファイル読み込みや文字コード問題が発生した場合はログ出力と代替テキストで後続処理を継続する。
- Azure OpenAI 呼び出しが失敗した場合はメッセージを保持し、最終レポート生成は可能な範囲で続行する。

## セキュリティ・秘匿情報
- `.env` の機微情報をコードやログに直接出力しない。
- 社内ネットワークのプロキシ設定を尊重し、ソースコードに固定値で埋め込まない。

## ドキュメントと成果物
- この `AGENTS.md` と `PLAN.md` を常に最新状態に保つ。
- ノートブック実行により、エクスポート成果物、個別要約、Mermaid 図、最終 Markdown レポートを生成することを目標とする。
